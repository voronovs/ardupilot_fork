# Dead Reckoning Failsafe LUA Script for ArduCopter
Скрипты хранятся на SD-карте и выполняются параллельно с полетным кодом.
## Алгоритм:
- После набора высоты 50м начинает работать скрипт
- При потере связи БВС начинает возврат с текущим азимутом назад (наклоном по тангажу) без использования GPS в режиме GUIDED_NO_GPS в течении таймаута (60сек) и уносится ветром
- После восстановления связи управление возвращается оператору
- если по истечении таймаута связь не восстановилась, дрон переходит в режим удержания высоты и уносится ветром
## Недостатки:
- отсутствует упреждение на ветер
- отсутствует проверка наличия GNSS
## Вопросы
- прятать скрипт в кастомной прошивке
- объем памяти, выделенной для скрипта
## TODO
- Требуется Очистка кэша после дизарма. Скрипт не заработал после второго арма
- SCR_HEAP_SIZE увеличить до 665600
- при отсутствии GPS, связи и таймаут вывести дрон в ALtHold. При наличии в RTL. Проверка качества GNSS-сигнала.
- Инструкция по работе с симулятором
- активация на высоте >60м и изучить, когда летают с возвышенности
- Разобраться с буфером, который заполнился через 15минут после начала полета. Запись AHRS не в буфер, а на microSD-карту.
- сценарий работы скрипта, когда видеосигнала уже нет, но связь сохраняется.
## Проверка в симуляторе
### Симулятор SITL в Mission Planner:
Запуск mavproxy:
`mavproxy --master=tcp:127.0.0.1:5763 --console`

Команды

Отключение RC:
`param set SIM_RC_FAIL 1`

Отключение GNSS:
`param set SIM_GPS_DISABLE 1`

Запуск скрипта в прошивке ArduPilot:
`SCR_ENABLE 0 -> 1`
## Запуск скрипта в прошивке ArduCopter